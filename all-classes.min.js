Ext.define("Ext.picker.Slot",{extend:"Ext.DataView",xtype:"pickerslot",alternateClassName:"Ext.Picker.Slot",requires:["Ext.XTemplate","Ext.data.Store","Ext.Component","Ext.data.StoreManager"],isSlot:!0,config:{title:null,showTitle:!0,cls:Ext.baseCSSPrefix+"picker-slot",name:null,value:null,flex:1,align:"left",displayField:"text",valueField:"value",scrollable:{direction:"vertical",indicators:!1,momentumEasing:{minVelocity:2},slotSnapEasing:{duration:100}}},constructor:function(){this.selectedIndex=0,this.callParent(arguments)},applyTitle:function(a){return a&&(a=Ext.create("Ext.Component",{cls:Ext.baseCSSPrefix+"picker-slot-title",docked:"top",html:a})),a},updateTitle:function(a,b){a&&(this.add(a),this.setupBar()),b&&this.remove(b)},updateShowTitle:function(a){var b=this.getTitle();b&&(b[a?"show":"hide"](),this.setupBar())},updateDisplayField:function(a){this.setItemTpl('<div class="'+Ext.baseCSSPrefix+'picker-item {cls} <tpl if="extra">'+Ext.baseCSSPrefix+'picker-invalid</tpl>">{'+a+"}</div>")},updateAlign:function(a,b){var c=this.element;c.addCls(Ext.baseCSSPrefix+"picker-"+a),c.removeCls(Ext.baseCSSPrefix+"picker-"+b)},applyData:function(a){var b=[],c=a&&a.length,d,e,f;if(a&&Ext.isArray(a)&&c)for(d=0;d<c;d++)e=a[d],f={},Ext.isArray(e)?(f[this.valueField]=e[0],f[this.displayField]=e[1]):Ext.isString(e)?(f[this.valueField]=e,f[this.displayField]=e):Ext.isObject(e)&&(f=e),b.push(f);return a},updateData:function(a){this.setStore(Ext.create("Ext.data.Store",{model:"x-textvalue",data:a}))},initialize:function(){this.callParent();var a=this.getScrollable().getScroller();this.on({scope:this,painted:"onPainted",itemtap:"doItemTap"}),a.on({scope:this,scrollend:"onScrollEnd"})},onPainted:function(){this.setupBar()},getPicker:function(){return this.picker||(this.picker=this.getParent()),this.picker},setupBar:function(){if(!this.rendered)return;var a=this.element,b=this.innerElement,c=this.getPicker(),d=c.bar,e=this.getValue(),f=this.getShowTitle(),g=this.getTitle(),h=this.getScrollable(),i=h.getScroller(),j=0,k,l,m,n,o;k=d.getY(),l=a.getY(),f&&g&&(l+=g.element.getHeight()),m=d.getHeight(),f&&g&&(j=g.element.getHeight()),n=Math.ceil((a.getHeight()-j-m)/2),this.slotPadding=n,b.setStyle({padding:n+"px 0 "+n+"px"}),i.refresh(),i.setSlotSnapSize(m),this.setValue(e)},doItemTap:function(a,b,c,d){var e=this;e.selectedIndex=b,e.selectedNode=c,e.scrollToItem(c,!0),e.fireEvent("slotpick",e,e.getValue(),e.selectedNode)},scrollToItem:function(a,b){var c=a.getY(),d=a.parent(),e=d.getY(),f=this.getScrollable(),g=f.getScroller(),h;h=c-e,g.scrollTo(0,h,b)},onScrollEnd:function(a,b,c){var d=this,e=Math.round(c/d.picker.bar.getHeight()),f=d.getViewItems(),g=f[e];g&&(d.selectedIndex=e,d.selectedNode=g,d.fireEvent("slotpick",d,d.getValue(),d.selectedNode))},getValue:function(){var a=this.getStore(),b,c;if(!a)return;return this.rendered?this._value===!1?null:(b=a.getAt(this.selectedIndex),c=b?b.get(this.getValueField()):null,this._value=c,c):this._value},setValue:function(a){if(!Ext.isDefined(a))return;if(!this.rendered||!a){this._value=a;return}var b=this.getStore(),c=this.getViewItems(),d=this.getValueField(),e,f;e=b.find(d,a),e!=-1&&(f=Ext.get(c[e]),this.selectedIndex=e,this.scrollToItem(f),this._value=a)},setValueAnimated:function(a){if(!a)return;if(!this.rendered){this._value=a;return}var b=this.getStore(),c=this.getViewItems(),d=this.getValueField(),e,f;e=b.find(d,a),e!=-1&&(f=Ext.get(c[e]),this.selectedIndex=e,this.scrollToItem(f,{duration:100}),this._value=a)}}),Ext.define("Ext.picker.Picker",{extend:"Ext.Sheet",alias:"widget.picker",alternateClassName:"Ext.Picker",requires:["Ext.picker.Slot","Ext.Toolbar","Ext.data.Model"],isPicker:!0,config:{cls:Ext.baseCSSPrefix+"picker",doneButton:!0,cancelButton:!0,useTitles:!1,slots:null,value:null,height:220,layout:{type:"hbox",align:"stretch"},centered:!1,left:0,right:0,bottom:0,defaultType:"pickerslot",toolbar:!0},initElement:function(){this.callParent(arguments);var a=this,b=Ext.baseCSSPrefix,c=this.innerElement;this.mask=c.createChild({cls:b+"picker-mask"}),this.bar=this.mask.createChild({cls:b+"picker-bar"}),a.on({scope:this,delegate:"pickerslot",slotpick:"onSlotPick"}),a.on({scope:this,show:"onShow"})},applyToolbar:function(a){return a===!0&&(a={}),Ext.applyIf(a,{docked:"top"}),Ext.factory(a,"Ext.TitleBar",this.getToolbar())},updateToolbar:function(a,b){a&&this.add(a),b&&this.remove(b)},applyDoneButton:function(a){return a&&(Ext.isBoolean(a)&&(a={}),typeof a=="string"&&(a={text:a}),Ext.applyIf(a,{ui:"action",align:"right",text:"Done"})),Ext.factory(a,"Ext.Button",this.getDoneButton())},updateDoneButton:function(a,b){var c=this.getToolbar();a?(c.add(a),a.on("tap",this.onDoneButtonTap,this)):b&&c.remove(b)},applyCancelButton:function(a){return a&&(Ext.isBoolean(a)&&(a={}),typeof a=="string"&&(a={text:a}),Ext.applyIf(a,{align:"left",text:"Cancel"})),Ext.factory(a,"Ext.Button",this.getCancelButton())},updateCancelButton:function(a,b){var c=this.getToolbar();a?(c.add(a),a.on("tap",this.onCancelButtonTap,this)):b&&c.remove(b)},updateUseTitles:function(a){var b=this.getInnerItems(),c=b.length,d=Ext.baseCSSPrefix+"use-titles",e,f;a?this.addCls(d):this.removeCls(d);for(e=0;e<c;e++)f=b[e],f.isSlot&&f.setShowTitle(a)},applySlots:function(a){if(a){var b=a.length,c;for(c=0;c<b;c++)a[c].picker=this}return a},updateSlots:function(a){var b=Ext.baseCSSPrefix,c;this.removeAll(),a&&this.add(a),c=this.getInnerItems(),c.length>0&&(c[0].addCls(b+"first"),c[c.length-1].addCls(b+"last")),this.updateUseTitles(this.getUseTitles())},onDoneButtonTap:function(){var a=this._value,b=this.getValue();b!=a&&this.fireEvent("change",this,b),this.hide()},onCancelButtonTap:function(){this.fireEvent("cancel",this),this.hide()},onSlotPick:function(a,b,c){this.fireEvent("pick",this,this.getValue(),a)},onShow:function(){this.isHidden()||this.setValue(this._value)},setValue:function(a,b){var c=this,d=c.getInnerItems(),e=d.length,f,g,h,i;if(!a){a={};for(i=0;i<e;i++)a[d[i].config.name]=!1}for(f in a){value=a[f];for(i=0;i<d.length;i++){h=d[i];if(h.config.name==f){g=h;break}}g&&(b?g.setValueAnimated(value):g.setValue(value))}return c._value=this.getValue(),c._values=c._value,c},setValueAnimated:function(a){this.setValue(a,!0)},getValue:function(){var a={},b=this.getItems().items,c=b.length,d,e;for(e=0;e<c;e++)d=b[e],d&&d.isSlot&&(a[d.getName()]=d.getValue());return this._values=a,this._values},getValues:function(){return this.getValue()},destroy:function(){this.callParent(),Ext.destroy(this.mask,this.bar)}},function(){Ext.deprecateProperty(this,"activeCls",null,"Ext.picker.Picker.activeCls has been removed"),Ext.deprecateClassMethod(this,"getCard","getActiveItem"),Ext.deprecateClassMethod(this,"setCard","setActiveItem"),Ext.define("x-textvalue",{extend:"Ext.data.Model",config:{fields:["text","value"]}})}),Ext.define("Ext.field.Select",{extend:"Ext.field.Text",xtype:"selectfield",alternateClassName:"Ext.form.Select",requires:["Ext.Panel","Ext.picker.Picker","Ext.data.Store","Ext.data.StoreManager","Ext.List"],config:{ui:"select",valueField:"value",displayField:"text",store:null,options:null,hiddenName:null,component:{useMask:!0},clearIcon:!1,usePicker:"auto",defaultPhonePickerConfig:null,defaultTabletPickerConfig:null,name:"picker"},constructor:function(a){a=a||{},a.store||(a.store=!0),this.callParent([a])},initialize:function(){var a=this,b=a.getComponent();a.callParent(),b.on({scope:a,masktap:"onMaskTap"}),b.input.dom.disabled=!0},updateDefaultPhonePickerConfig:function(a){var b=this.picker;b&&b.setConfig(a)},updateDefaultTabletPickerConfig:function(a){var b=this.listPanel;b&&b.setConfig(a)},applyUsePicker:function(a){return a=="auto"&&(a=Ext.os.deviceType=="Phone"),Boolean(a)},syncEmptyCls:Ext.emptyFn,applyValue:function(a){var b=a,c;return this.getOptions(),a instanceof Ext.data.Model||(c=this.getStore().find(this.getValueField(),a,null,null,null,!0),c==-1&&(c=this.getStore().find(this.getDisplayField(),a,null,null,null,!0)),b=this.getStore().getAt(c)),b},updateValue:function(a,b){this.previousRecord=b,this.record=a,this.callParent([a?a.get(this.getDisplayField()):""]),b!==a&&this.initialized&&this.fireEvent("change",this,a,b)},getValue:function(){var a=this.record;return a?a.get(this.getValueField()):null},getRecord:function(){return this.record},getPhonePicker:function(){var a=this.getDefaultPhonePickerConfig();return this.picker||(this.picker=Ext.create("Ext.picker.Picker",Ext.apply({slots:[{align:"center",name:this.getName(),valueField:this.getValueField(),displayField:this.getDisplayField(),value:this.getValue(),store:this.getStore()}],listeners:{change:this.onPickerChange,scope:this}},a))),this.picker},getTabletPicker:function(){var a=this.getDefaultTabletPickerConfig();return this.listPanel||(this.listPanel=Ext.create("Ext.Panel",Ext.apply({centered:!0,modal:!0,cls:Ext.baseCSSPrefix+"select-overlay",layout:"fit",hideOnMaskTap:!0,items:{xtype:"list",store:this.getStore(),itemTpl:'<span class="x-list-label">{'+this.getDisplayField()+"}</span>",listeners:{select:this.onListSelect,itemtap:this.onListTap,scope:this}}},a))),this.listPanel},onMaskTap:function(){return this.getDisabled()?!1:(this.showPicker(),!1)},showPicker:function(){if(this.getStore().getCount()===0)return;if(this.getReadOnly())return;this.isFocused=!0;if(this.getUsePicker()){var a=this.getPhonePicker(),b=this.getName(),c={};c[b]=this.record.get(this.getValueField()),a.setValue(c),a.getParent()||Ext.Viewport.add(a),a.show()}else{var d=this.getTabletPicker(),e=d.down("list"),f=e.getStore(),g=f.find(this.getValueField(),this.getValue(),null,null,null,!0),h=f.getAt(g==-1?0:g);d.getParent()||Ext.Viewport.add(d),d.showBy(this.getComponent()),e.select(h,null,!0)}},onListSelect:function(a,b){var c=this;b&&c.setValue(b)},onListTap:function(){this.listPanel.hide({type:"fade",out:!0,scope:this})},onPickerChange:function(a,b){var c=this,d=b[c.getName()],e=c.getStore(),f=e.find(c.getValueField(),d,null,null,null,!0),g=e.getAt(f);c.setValue(g)},updateOptions:function(a){var b=this.getStore();a?(b.setData(a),this.onStoreDataChanged(b)):b.clearData()},applyStore:function(a){return a===!0&&(a=Ext.create("Ext.data.Store",{fields:[this.getValueField(),this.getDisplayField()]})),a&&(a=Ext.data.StoreManager.lookup(a),a.on({scope:this,addrecords:this.onStoreDataChanged,removerecords:this.onStoreDataChanged,updaterecord:this.onStoreDataChanged,refresh:this.onStoreDataChanged})),a},updateStore:function(a){a&&this.onStoreDataChanged(a)},onStoreDataChanged:function(a){var b=this.getInitialConfig(),c=this.getValue();Ext.isDefined(c)&&this.updateValue(this.applyValue(c)),this.getValue()===null&&(b.hasOwnProperty("value")&&this.setValue(b.value),this.getValue()===null&&a.getCount()>0&&this.setValue(a.getAt(0)))},doSetDisabled:function(a){Ext.Component.prototype.doSetDisabled.apply(this,arguments)},setDisabled:function(){Ext.Component.prototype.setDisabled.apply(this,arguments)},reset:function(){var a=this.getStore(),b=this.originalValue?this.originalValue:a.getAt(0);return a&&b&&this.setValue(b),this},onFocus:function(a){this.fireEvent("focus",this,a),this.isFocused=!0,this.showPicker()},destroy:function(){this.callParent(arguments),Ext.destroy(this.listPanel,this.picker,this.hiddenField)}})