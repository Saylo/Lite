Ext.define("Ext.field.Select",{extend:"Ext.field.Text",xtype:"selectfield",alternateClassName:"Ext.form.Select",requires:["Ext.Panel","Ext.picker.Picker","Ext.data.Store","Ext.data.StoreManager","Ext.List"],config:{ui:"select",valueField:"value",displayField:"text",store:null,options:null,hiddenName:null,component:{useMask:!0},clearIcon:!1,usePicker:"auto",defaultPhonePickerConfig:null,defaultTabletPickerConfig:null,name:"picker"},constructor:function(a){a=a||{},a.store||(a.store=!0),this.callParent([a])},initialize:function(){var a=this,b=a.getComponent();a.callParent(),b.on({scope:a,masktap:"onMaskTap"}),b.input.dom.disabled=!0},updateDefaultPhonePickerConfig:function(a){var b=this.picker;b&&b.setConfig(a)},updateDefaultTabletPickerConfig:function(a){var b=this.listPanel;b&&b.setConfig(a)},applyUsePicker:function(a){return a=="auto"&&(a=Ext.os.deviceType=="Phone"),Boolean(a)},syncEmptyCls:Ext.emptyFn,applyValue:function(a){var b=a,c;return this.getOptions(),a instanceof Ext.data.Model||(c=this.getStore().find(this.getValueField(),a,null,null,null,!0),c==-1&&(c=this.getStore().find(this.getDisplayField(),a,null,null,null,!0)),b=this.getStore().getAt(c)),b},updateValue:function(a,b){this.previousRecord=b,this.record=a,this.callParent([a?a.get(this.getDisplayField()):""]),b!==a&&this.initialized&&this.fireEvent("change",this,a,b)},getValue:function(){var a=this.record;return a?a.get(this.getValueField()):null},getRecord:function(){return this.record},getPhonePicker:function(){var a=this.getDefaultPhonePickerConfig();return this.picker||(this.picker=Ext.create("Ext.picker.Picker",Ext.apply({slots:[{align:"center",name:this.getName(),valueField:this.getValueField(),displayField:this.getDisplayField(),value:this.getValue(),store:this.getStore()}],listeners:{change:this.onPickerChange,scope:this}},a))),this.picker},getTabletPicker:function(){var a=this.getDefaultTabletPickerConfig();return this.listPanel||(this.listPanel=Ext.create("Ext.Panel",Ext.apply({centered:!0,modal:!0,cls:Ext.baseCSSPrefix+"select-overlay",layout:"fit",hideOnMaskTap:!0,items:{xtype:"list",store:this.getStore(),itemTpl:'<span class="x-list-label">{'+this.getDisplayField()+"}</span>",listeners:{select:this.onListSelect,itemtap:this.onListTap,scope:this}}},a))),this.listPanel},onMaskTap:function(){return this.getDisabled()?!1:(this.showPicker(),!1)},showPicker:function(){if(this.getStore().getCount()===0)return;if(this.getReadOnly())return;this.isFocused=!0;if(this.getUsePicker()){var a=this.getPhonePicker(),b=this.getName(),c={};c[b]=this.record.get(this.getValueField()),a.setValue(c),a.getParent()||Ext.Viewport.add(a),a.show()}else{var d=this.getTabletPicker(),e=d.down("list"),f=e.getStore(),g=f.find(this.getValueField(),this.getValue(),null,null,null,!0),h=f.getAt(g==-1?0:g);d.getParent()||Ext.Viewport.add(d),d.showBy(this.getComponent()),e.select(h,null,!0)}},onListSelect:function(a,b){var c=this;b&&c.setValue(b)},onListTap:function(){this.listPanel.hide({type:"fade",out:!0,scope:this})},onPickerChange:function(a,b){var c=this,d=b[c.getName()],e=c.getStore(),f=e.find(c.getValueField(),d,null,null,null,!0),g=e.getAt(f);c.setValue(g)},updateOptions:function(a){var b=this.getStore();a?(b.setData(a),this.onStoreDataChanged(b)):b.clearData()},applyStore:function(a){return a===!0&&(a=Ext.create("Ext.data.Store",{fields:[this.getValueField(),this.getDisplayField()]})),a&&(a=Ext.data.StoreManager.lookup(a),a.on({scope:this,addrecords:this.onStoreDataChanged,removerecords:this.onStoreDataChanged,updaterecord:this.onStoreDataChanged,refresh:this.onStoreDataChanged})),a},updateStore:function(a){a&&this.onStoreDataChanged(a)},onStoreDataChanged:function(a){var b=this.getInitialConfig(),c=this.getValue();Ext.isDefined(c)&&this.updateValue(this.applyValue(c)),this.getValue()===null&&(b.hasOwnProperty("value")&&this.setValue(b.value),this.getValue()===null&&a.getCount()>0&&this.setValue(a.getAt(0)))},doSetDisabled:function(a){Ext.Component.prototype.doSetDisabled.apply(this,arguments)},setDisabled:function(){Ext.Component.prototype.setDisabled.apply(this,arguments)},reset:function(){var a=this.getStore(),b=this.originalValue?this.originalValue:a.getAt(0);return a&&b&&this.setValue(b),this},onFocus:function(a){this.fireEvent("focus",this,a),this.isFocused=!0,this.showPicker()},destroy:function(){this.callParent(arguments),Ext.destroy(this.listPanel,this.picker,this.hiddenField)}})